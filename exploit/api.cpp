#include "../global.h"
#include "./swind2.h"

extern "C" __declspec(dllexport) DWORD GetLoaderVersion()
{
	return 1;
}

extern "C" __declspec(dllexport) intptr_t GetCiOptionsAddress()
{
	PVOID addr = nullptr;
	NTSTATUS status = AnalyzeCi(&addr);

	if (!NT_SUCCESS(status))
	{
		return 0;
	}
	
	return reinterpret_cast<intptr_t>(addr);
}

extern "C" __declspec(dllexport) BOOL ReadCIOptions(_Out_opt_ PULONG ciOptionsValue)
{
	NTSTATUS Status = ReadCIOptionsFromMemory(ciOptionsValue);
	return NT_SUCCESS(Status);
}

extern "C" __declspec(dllexport) BOOL IsDSEPatched()
{
	return InitialCiOptionsValue.has_value;
}

extern "C" __declspec(dllexport) BOOL DSEEnable()
{
	NTSTATUS Status = DSEChangeState(TRUE);
	return NT_SUCCESS(Status);
}

extern "C" __declspec(dllexport) BOOL DSEDisable()
{
	NTSTATUS Status = DSEChangeState(FALSE);
	return NT_SUCCESS(Status);
}
